<!doctype html>
<meta charset="utf-8">

<link href="style.css" rel="stylesheet">

<script src="https://distill.pub/template.v1.js"></script>

<script type="text/front-matter">
  title: "YOLOv4 Receptive Field Visualization"
  description: "Just some interactive animations for visualizing YOLOv4 state of the art object detection approach."
  authors:
  - Author 1: http://author1.website
  - Author 2: http://author2.website
  - Author 3: http://author3.website
  affiliations:
  - Bielefeld University: http://uni-bielefeld.de
  - Bielefeld University: http://uni-bielefeld.de
  - Bielefeld University: http://uni-bielefeld.de
</script>

<dt-article>
  <h1>YOLO - You only look <strike>once</strike> 10647 times</h1>
  <!---  (52*52 + 13*13 + 26*26) * 3 = 10647 --->
  <h2>An enlightening look behind the scenes of YOLOv4<dt-cite key="bochkovskiy2020yolov4"></dt-cite> state-of-the-art object detection approach and what the <i>once</i> actually means</h2>
  <dt-byline></dt-byline>

<h2> Select an Image for Visualization</h2>
<div id="fig_select">
	<img class="fig_select_img" src="figs/0/base_img.jpg" onclick="base_img = '0'; reload_visu();"></img>
	<img class="fig_select_img" src="figs/1/base_img.jpg" onclick="base_img = '1'; reload_visu();"></img>
	<img class="fig_select_img" src="figs/2/base_img.jpg" onclick="base_img = '2'; reload_visu();"></img>
	<img class="fig_select_img" src="figs/3/base_img.jpg" onclick="base_img = '3'; reload_visu();"></img>
	<img class="fig_select_img" src="figs/4/base_img.jpg" onclick="base_img = '4'; reload_visu();"></img>
</div>

<p>Changes from last version: different loss, colored (signed) gradients, p active for specific class</p>

<p>Classes for p are (for image 1 to 5): sandwich, laptop, person, cat, pizza</p>


Loss: 

<dt-code block language="python">


mask1_tensor = tf.convert_to_tensor(mask1, dtype=tf.float32)
mask1_output = mask1_tensor * preds[pred_i]
loss1 = tf.reduce_sum(mask1_output/tf.math.reduce_sum(mask1_output))
losses.append(loss1)

</dt-code>


Normalization and signed Gradients: 


<dt-code block language="python">

fixed_normalization_factor = 1000000000
fixed_normalization = np.abs(grad * fixed_normalization_factor)
fixed_normalization[fixed_normalization > 1.0] = 1.0

grad_1d = grad.mean(axis=2) * fixed_normalization_factor
grad_1d_p = grad_1d >= 0
grad_1d_n = grad_1d < 0
grad_pn = np.zeros(grad.shape, dtype=np.float)

grad_pn[grad_1d_p, 0] = np.abs(grad_1d)[grad_1d_p]
grad_pn[grad_1d_n, 2] = np.abs(grad_1d)[grad_1d_n]


</dt-code>




<h2>Different Grid Sizes</h2>

<div class="m-page">
	<div class="bbs_visu">
		<div></div>														<img class="arrow" src="gfx/l.png"/>		<canvas class="canv"  id="bbs_--l_x-----"></canvas>
		<canvas class="control_canv" id="control_canv"></canvas>		<img class="arrow" src="gfx/m.png"/>		<canvas class="canv"  id="bbs_-m-_x-----"></canvas>
		<div></div>														<img class="arrow" src="gfx/s.png"/>		<canvas class="canv"  id="bbs_s--_x-----"></canvas>
	</div>
</div>

<h2>Visualization of Static Gradients on large Grid</h2>

<div class="l-page">
	<div class="grad_visu">
		<canvas class="control_canv" id="control_canv"></canvas>		<div>X</div>		<canvas class="canv"  id="static-grad_--l_x-----"></canvas>		<div>Y</div>		<canvas class="canv"  id="static-grad_--l_-y----"></canvas>
		<div></div>														<div>W</div>		<canvas class="canv"  id="static-grad_--l_--w---"></canvas>		<div>H</div>		<canvas class="canv"  id="static-grad_--l_---h--"></canvas>
		<div></div>														<div>C</div>		<canvas class="canv"  id="static-grad_--l_----c-"></canvas>		<div>P</div>		<canvas class="canv"  id="static-grad_--l_-----p"></canvas>

	</div>
</div>

<h2>Visualization of Static Gradients on medium Grid</h2>

<div class="l-page">
	<div class="grad_visu">
		<canvas class="control_canv" id="control_canv"></canvas>		<div>X</div>		<canvas class="canv"  id="static-grad_-m-_x-----"></canvas>		<div>Y</div>		<canvas class="canv"  id="static-grad_-m-_-y----"></canvas>
		<div></div>														<div>W</div>		<canvas class="canv"  id="static-grad_-m-_--w---"></canvas>		<div>H</div>		<canvas class="canv"  id="static-grad_-m-_---h--"></canvas>
		<div></div>														<div>C</div>		<canvas class="canv"  id="static-grad_-m-_----c-"></canvas>		<div>P</div>		<canvas class="canv"  id="static-grad_-m-_-----p"></canvas>

	</div>
</div>

<h2>Visualization of Static Gradients on small Grid</h2>

<div class="l-page">
	<div class="grad_visu">
		<canvas class="control_canv" id="control_canv"></canvas>		<div>X</div>		<canvas class="canv"  id="static-grad_s--_x-----"></canvas>		<div>Y</div>		<canvas class="canv"  id="static-grad_s--_-y----"></canvas>
		<div></div>														<div>W</div>		<canvas class="canv"  id="static-grad_s--_--w---"></canvas>		<div>H</div>		<canvas class="canv"  id="static-grad_s--_---h--"></canvas>
		<div></div>														<div>C</div>		<canvas class="canv"  id="static-grad_s--_----c-"></canvas>		<div>P</div>		<canvas class="canv"  id="static-grad_s--_-----p"></canvas>


	</div>
</div>



<h2>Visualization of Signed Gradients on large Grid</h2>

<div class="l-page">
	<div class="grad_visu">
		<canvas class="control_canv" id="control_canv"></canvas>		<div>X</div>		<canvas class="canv"  id="static-grad-pn_--l_x-----"></canvas>		<div>Y</div>		<canvas class="canv"  id="static-grad-pn_--l_-y----"></canvas>
		<div></div>														<div>W</div>		<canvas class="canv"  id="static-grad-pn_--l_--w---"></canvas>		<div>H</div>		<canvas class="canv"  id="static-grad-pn_--l_---h--"></canvas>
		<div></div>														<div>C</div>		<canvas class="canv"  id="static-grad-pn_--l_----c-"></canvas>		<div>P</div>		<canvas class="canv"  id="static-grad-pn_--l_-----p"></canvas>

	</div>
</div>

<h2>Visualization of Signed Gradients on medium Grid</h2>

<div class="l-page">
	<div class="grad_visu">
		<canvas class="control_canv" id="control_canv"></canvas>		<div>X</div>		<canvas class="canv"  id="static-grad-pn_-m-_x-----"></canvas>		<div>Y</div>		<canvas class="canv"  id="static-grad-pn_-m-_-y----"></canvas>
		<div></div>														<div>W</div>		<canvas class="canv"  id="static-grad-pn_-m-_--w---"></canvas>		<div>H</div>		<canvas class="canv"  id="static-grad-pn_-m-_---h--"></canvas>
		<div></div>														<div>C</div>		<canvas class="canv"  id="static-grad-pn_-m-_----c-"></canvas>		<div>P</div>		<canvas class="canv"  id="static-grad-pn_-m-_-----p"></canvas>

	</div>
</div>

<h2>Visualization of Signed Gradients on small Grid</h2>

<div class="l-page">
	<div class="grad_visu">
		<canvas class="control_canv" id="control_canv"></canvas>		<div>X</div>		<canvas class="canv"  id="static-grad-pn_s--_x-----"></canvas>		<div>Y</div>		<canvas class="canv"  id="static-grad-pn_s--_-y----"></canvas>
		<div></div>														<div>W</div>		<canvas class="canv"  id="static-grad-pn_s--_--w---"></canvas>		<div>H</div>		<canvas class="canv"  id="static-grad-pn_s--_---h--"></canvas>
		<div></div>														<div>C</div>		<canvas class="canv"  id="static-grad-pn_s--_----c-"></canvas>		<div>P</div>		<canvas class="canv"  id="static-grad-pn_s--_-----p"></canvas>


	</div>
</div>








</dt-article>

<dt-appendix>
</dt-appendix>

<script type="text/bibliography">


@article{bochkovskiy2020yolov4,
  title={Yolov4: Optimal speed and accuracy of object detection},
  author={Bochkovskiy, Alexey and Wang, Chien-Yao and Liao, Hong-Yuan Mark},
  journal={arXiv preprint arXiv:2004.10934},
  year={2020}
}

</script>


<script src="js/jquery-3.4.1.min.js"></script>
<script src="js/grid_visu.js"></script>

